<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script type="text/javascript">
function update_messages() {
	$.ajax("/message", {
		dataType: "json",
		success: function(data, _, _) {
			str = "";
			Object.entries(data).forEach(function(kv, _, _) {
				origin = kv[0]
				msgs = kv[1]
				msgs.forEach(function(msg, _, _) {
					str += origin + ": " + msg + "\n";
				})
			})

			$("#messages").text(str)
		},
	})
}

function update_nodes() {
	$.ajax("/node", {
		dataType: "json",
		success: function(data, _, _) {
			str = ""
			data.forEach(function(node, _, _) {
				str += node + "\n"
			})
			$("#nodes").text(str)
		},
	})
}

function update_id() {
	$.ajax("/id", {
		success: function(data, _, _) {
			$("#id").val(data)
		},
	})
}

function send_message() {
	$.post("/message", $("#message").val(), update_messages)
};

function add_node() {
	$.post("/node", $("#node").val(), update_nodes)
};

function change_id() {
	$.post("/id", $("#id").val(), update_id)
};

update_messages()
setInterval(update_messages, 1000)

update_nodes()
setInterval(update_nodes, 1000)

update_id()
		</script>
	</head>

	<h2>Chat box</h2>
	<textarea id="messages" disabled></textarea>
	<p>
	<input id="message"/>
	<button onclick="send_message()">send message</button>

	<h2>Node box</h2>
	<textarea id="nodes" disabled></textarea>
	<p>
	<input id="node"/>
	<button onclick="add_node()">add node</button>

	<h2>ID box</h2>
	<input id="id"/>
	<button onclick="change_id()">change id</button>
<html>
